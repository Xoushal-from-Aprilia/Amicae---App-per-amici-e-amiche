<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amicae - Connessi</title>
    <!-- Caricamento Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Caricamento Google Font "Inter" -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Stile di base e font */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            height: 100vh;
            overflow: hidden;
            background-color: #f9fafb; 
            color: #1f2937;
        }

        /* Contenitore principale delle viste (App Stack) */
        .app-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.35s ease-out, opacity 0.35s;
            will-change: transform, opacity;
            opacity: 0;
            pointer-events: none;
            z-index: 10;
        }

        .app-view.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
            z-index: 20;
        }

        .app-view.slide-from-bottom { transform: translateY(100%); }

        /* Stile Modale "Sheet" (minimalista) */
        .modal-sheet {
            transition: transform 0.3s ease-out;
            transform: translateY(100%);
        }
        .modal-sheet.open {
            transform: translateY(0);
        }

        /* Stile bolle chat (Minimal) */
        .bubble-sent {
            border-bottom-right-radius: 4px; 
            background-color: #4f46e5; 
        }
        .bubble-received {
            border-bottom-left-radius: 4px;
            background-color: #e5e7eb; 
            color: #1f2937;
        }

        /* Nasconde la scrollbar del contenitore chat */
        #chat-messages::-webkit-scrollbar { display: none; }
        #chat-messages { -ms-overflow-style: none; scrollbar-width: none; }

        /* Icona di trascinamento nel Modale (Minimal) */
        .handle-bar {
            width: 40px;
            height: 4px;
            background-color: #ccc;
            border-radius: 2px;
            margin: 0 auto 1rem auto;
        }
    </style>
</head>
<body class="h-screen overflow-hidden bg-gray-50 antialiased">

    <!-- Contenitore principale dell'app (shell) -->
    <div class="relative w-full h-full overflow-hidden">

        <!-- VISTA: Caricamento Iniziale -->
        <div id="loading-view" class="app-view visible flex flex-col items-center justify-center h-full bg-white">
            <svg class="animate-spin h-8 w-8 text-indigo-600 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <h2 class="text-xl font-medium text-gray-800 tracking-wide">Amicae</h2>
            <p class="text-gray-500 mt-1 text-sm">Caricamento...</p>
        </div>

        <!-- VISTA: Autenticazione (Layout Minimal Modulare) -->
        <div id="auth-view" class="app-view slide-from-bottom flex flex-col items-center justify-center p-8 bg-gray-50">
            
            <div class="max-w-md w-full text-center">
                <h1 class="text-5xl font-extrabold text-gray-900 mb-2">Amicae</h1>
                <p class="text-md font-light text-gray-500 mb-10">Connettiti in modo sicuro e istantaneo.</p>
                
                <div class="p-6 bg-white rounded-2xl shadow-lg border border-gray-100">
                    <button id="show-create-tab-button" class="w-full bg-indigo-600 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-150 hover:bg-indigo-700 active:scale-[0.99] focus:outline-none focus:ring-2 focus:ring-indigo-500/50 mb-3">
                        Crea un Nuovo Codice
                    </button>
                    <button id="show-join-tab-button" class="w-full bg-transparent border border-gray-300 text-gray-700 font-medium py-3 px-6 rounded-xl transition-all duration-150 hover:bg-gray-100 active:scale-[0.99] focus:outline-none focus:ring-2 focus:ring-gray-300">
                        Unisciti con un Codice
                    </button>
                </div>
            </div>
        </div>

        <!-- VISTA: App Principale (Chat) -->
        <div id="main-app-view" class="app-view slide-from-bottom flex flex-col bg-white">
            <!-- Header Pulito (Nome partner/Status) -->
            <header class="bg-white border-b border-gray-200 p-4 flex items-center justify-between shadow-sm flex-shrink-0 z-10">
                <h1 class="text-xl font-extrabold text-gray-900">Chat</h1>
                <div class="flex items-center space-x-2">
                    <span id="partner-status" class="text-xs font-medium px-3 py-1 rounded-full text-green-700 bg-green-100">Partner ID...</span>
                </div>
            </header>
            
            <!-- Contenitore messaggi chat -->
            <div id="chat-messages" class="flex-grow p-4 pt-1 flex flex-col gap-3 overflow-y-auto bg-gray-50">
                <!-- I messaggi della chat verranno inseriti qui da JS -->
            </div>
            
            <!-- Footer Input Pulito (Stile iMessage) -->
            <footer class="p-3 bg-white flex-shrink-0 border-t border-gray-100">
                <div class="flex gap-2 items-end">
                    <input id="chat-input" type="text" class="flex-grow w-full px-4 py-2 text-sm rounded-2xl border border-gray-300 bg-gray-50 text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 transition-colors" placeholder="iMessage style: Scrivi un messaggio...">
                    
                    <button id="send-button" class="bg-indigo-600 text-white rounded-full p-2.5 flex-shrink-0 transition-transform duration-100 transform hover:bg-indigo-700 active:scale-95 disabled:bg-indigo-300" disabled>
                        <!-- Icona invio (Freccia) -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" transform="rotate(90 12 12)" />
                        </svg>
                    </button>
                </div>
            </footer>
        </div>

        <!-- MODALE PRINCIPALE (Sheet Modale - App Stack 2) -->
        <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden flex items-end justify-center z-50 transition-opacity duration-300 opacity-0">
            <div id="modal-sheet-content" class="modal-sheet w-full max-w-lg bg-white rounded-t-3xl shadow-2xl p-6 relative">
                
                <!-- Barra di trascinamento/chiusura -->
                <div class="handle-bar mb-6 cursor-pointer" id="close-modal-handle"></div>

                <!-- Contenuto del Modale a Schede -->
                <div class="flex flex-col">
                    <!-- Tab Selector -->
                    <div class="flex border-b border-gray-200 mb-8">
                        <button id="tab-create" class="flex-1 text-center py-3 text-sm font-medium border-b-2 transition-all" data-tab="create">Crea</button>
                        <button id="tab-join" class="flex-1 text-center py-3 text-sm font-medium border-b-2 transition-all" data-tab="join">Unisciti</button>
                    </div>

                    <!-- Scheda: Crea Codice -->
                    <div id="tab-content-create" class="tab-content">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2 text-center">Il Tuo Codice</h2>
                        <p class="text-gray-500 mb-8 text-center">Condividi questo codice segreto per connetterti:</p>
                        
                        <div class="bg-gray-100 rounded-xl p-6 mb-8 text-center border border-gray-200">
                            <span id="code-display" class="text-6xl font-extrabold tracking-widest text-indigo-600">...</span>
                        </div>
                        
                        <div class="flex items-center justify-center space-x-2">
                            <div class="w-3 h-3 bg-indigo-300 rounded-full animate-pulse"></div>
                            <div class="w-3 h-3 bg-indigo-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                            <div class="w-3 h-3 bg-indigo-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                        </div>
                        <p class="text-gray-500 mt-4 text-sm text-center">In attesa che un partner si unisca...</p>
                    </div>

                    <!-- Scheda: Unisciti con Codice -->
                    <div id="tab-content-join" class="tab-content hidden">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2 text-center">Inserisci il Codice</h2>
                        <p class="text-gray-500 mb-6 text-center">Digita il codice di 6 cifre fornito dal tuo partner.</p>
                        
                        <input id="code-input" type="number" maxlength="6" class="w-full text-center text-3xl font-bold p-4 rounded-xl border border-gray-300 bg-gray-50 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors" placeholder="000000">
                        
                        <button id="join-button" class="w-full bg-indigo-600 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-150 hover:bg-indigo-700 active:scale-[0.99] focus:outline-none focus:ring-2 focus:ring-indigo-500/50 mt-8">
                            Connettiti
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modale per messaggi/errori (Sostituisce window.alert) -->
        <div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0">
            <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center transform transition-all scale-95 border border-gray-200">
                <p id="modal-text" class="text-md text-gray-800 mb-6"></p>
                <button id="modal-close-button" class="w-full bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg transition-all hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500/50">
                    OK
                </button>
            </div>
        </div>


    <!-- Script Firebase e Logica App -->
    <script type="module">
        // Importa funzioni Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc, 
            updateDoc, 
            onSnapshot, 
            collection, 
            addDoc, 
            query, 
            serverTimestamp, 
            setLogLevel,
            limit
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Variabili Globali (dall'ambiente Canvas) ---
        
        // Fallback configuration if canvas environment variables are not set
        const userFallbackConfig = {
            apiKey: "AIzaSyDHALYDfyXQIiEzc8IfH7aKjiyXNAWX4_0",
            authDomain: "amicae-99c7b.firebaseapp.com",
            projectId: "amicae-99c7b",
            storageBucket: "amicae-99c7b.firebasestorage.app",
            messagingSenderId: "379845487963",
            appId: "1:379845487963:web:e73dc5c970e627676c7e7e",
            measurementId: "G-LYV92RTCX7"
        };

        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' 
            ? __firebase_config 
            : JSON.stringify(userFallbackConfig)); 
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Inizializzazione Firebase
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            setLogLevel('Debug');
        } catch (e) {
            console.error("Errore inizializzazione Firebase:", e);
            document.getElementById('loading-view').innerHTML = '<h2 class="text-xl font-semibold text-red-600">Errore di configurazione.</h2>';
        }

        // Stato dell'applicazione
        let userId = null;
        let pairingCode = null;
        let partnerId = null;
        let pairingListenerUnsubscribe = null;
        let messagesListenerUnsubscribe = null;
        let isAuthReady = false; // Stato di prontezza dell'autenticazione

        // Riferimenti DOM
        const views = {
            loading: document.getElementById('loading-view'),
            auth: document.getElementById('auth-view'),
            main: document.getElementById('main-app-view')
        };
        const modal = document.getElementById('auth-modal');
        const modalSheetContent = document.getElementById('modal-sheet-content');
        const codeDisplay = document.getElementById('code-display');
        const codeInput = document.getElementById('code-input');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const partnerStatus = document.getElementById('partner-status');

        // Modale Messaggi
        const messageModal = document.getElementById('message-modal');
        const modalText = document.getElementById('modal-text');
        const modalContent = messageModal.querySelector('div'); 

        // --- Funzioni di Utility ---

        /**
         * Mostra una vista principale con animazione
         * @param {string} viewId 'loading', 'auth', or 'main'
         */
        function showView(viewId) {
            Object.keys(views).forEach(key => {
                const view = views[key];
                if (key === viewId) {
                    view.classList.add('visible');
                    view.classList.remove('slide-from-bottom');
                } else {
                    view.classList.remove('visible');
                    // Reimposta la posizione di partenza
                    view.classList.add('slide-from-bottom');
                }
            });
        }

        /**
         * Mostra un messaggio modale (sostituto di alert)
         * @param {string} message Testo da mostrare
         */
        function showMessage(message) {
            modalText.textContent = message;
            messageModal.classList.remove('hidden');
            setTimeout(() => {
                messageModal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
            }, 10);
        }

        // Evento chiusura modale messaggi
        document.getElementById('modal-close-button').addEventListener('click', () => {
            messageModal.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            setTimeout(() => messageModal.classList.add('hidden'), 300);
        });

        // --- Logica Modale Auth (Sheet) ---

        /**
         * Apre il modale con la scheda specificata.
         * @param {string} tab 'create' o 'join'
         */
        function openAuthModal(tab) {
            if (!isAuthReady) {
                showMessage("L'app non è ancora pronta. Attendi qualche istante.");
                return;
            }
            // 1. Mostra il Modale (sfondo)
            modal.classList.remove('hidden', 'opacity-0');
            
            // 2. Animazione di ingresso dello sheet
            setTimeout(() => {
                modal.classList.add('opacity-100');
                modalSheetContent.classList.add('open');
            }, 10);
            
            // 3. Seleziona la scheda
            switchTab(tab);
        }

        function closeAuthModal() {
            // 1. Animazione di uscita dello sheet
            modalSheetContent.classList.remove('open');
            
            // 2. Animazione di uscita del Modale (sfondo)
            setTimeout(() => {
                modal.classList.add('opacity-0');
                modal.classList.add('hidden');
            }, 300);
            
            // Resetta lo stato (importante se era in 'create' in attesa)
            if (pairingListenerUnsubscribe) {
                pairingListenerUnsubscribe();
                pairingListenerUnsubscribe = null;
                codeDisplay.textContent = '...';
            }
        }
        
        // Eventi di apertura/chiusura
        document.getElementById('show-create-tab-button').addEventListener('click', () => openAuthModal('create'));
        document.getElementById('show-join-tab-button').addEventListener('click', () => openAuthModal('join'));
        document.getElementById('close-modal-handle').addEventListener('click', closeAuthModal);
        // Chiusura cliccando fuori dal modale
        modal.addEventListener('click', (e) => {
            if (e.target.id === 'auth-modal') {
                closeAuthModal();
            }
        });

        // Logica cambio schede
        const tabContents = {
            create: document.getElementById('tab-content-create'),
            join: document.getElementById('tab-content-join')
        };
        const tabButtons = {
            create: document.getElementById('tab-create'),
            join: document.getElementById('tab-join')
        };
        
        function switchTab(tabId) {
            Object.keys(tabContents).forEach(key => {
                if (key === tabId) {
                    tabContents[key].classList.remove('hidden');
                    tabButtons[key].classList.add('text-indigo-600', 'border-indigo-600');
                } else {
                    tabContents[key].classList.add('hidden');
                    tabButtons[key].classList.remove('text-indigo-600', 'border-indigo-600');
                    tabButtons[key].classList.add('text-gray-500', 'border-transparent', 'hover:border-gray-300');
                }
            });
            // Resetta l'input quando si cambia scheda per pulizia
            if (tabId === 'join') codeInput.value = '';
            // Se si passa a join, disattiva l'ascolto se attivo
            if (tabId === 'join' && pairingListenerUnsubscribe) {
                pairingListenerUnsubscribe();
                pairingListenerUnsubscribe = null;
                codeDisplay.textContent = '...';
            }
        }

        tabButtons.create.addEventListener('click', () => switchTab('create'));
        tabButtons.join.addEventListener('click', () => switchTab('join'));

// --- Logica di Autenticazione ---

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("Utente autenticato:", user.uid);
                userId = user.uid;
                isAuthReady = true;
                // Piccolo ritardo per mostrare l'animazione di caricamento
                setTimeout(() => showView('auth'), 500); 
            } else {
                console.log("Nessun utente, tentativo di login anonimo...");
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Errore di autenticazione:", error);
                    showMessage("Impossibile autenticarsi. Riprova più tardi.");
                }
            }
        });

        // --- Logica di Connessione (Pairing) ---

        async function handleCreateConnection() {
            if (!userId) return;
            
            if (pairingListenerUnsubscribe) pairingListenerUnsubscribe();

            // Genera codice di 6 cifre
            const newCode = Math.floor(100000 + Math.random() * 900000).toString();
            pairingCode = newCode;
            
            // Collezione pubblica per i pairing
            const pairDocRef = doc(db, 'artifacts', appId, 'public/data/pairings', pairingCode);
            
            try {
                // Crea il documento di pairing
                await setDoc(pairDocRef, {
                    initiatorId: userId,
                    status: 'pending',
                    createdAt: serverTimestamp()
                });
                
                codeDisplay.textContent = pairingCode;
                
                // Avvia l'ascolto per la connessione del partner
                listenForPairing(pairDocRef);

            } catch (error) {
                console.error("Errore creazione connessione:", error);
                showMessage("Impossibile creare la connessione. Riprova.");
                closeAuthModal();
            }
        }

        // Questo gestore viene chiamato quando si passa alla scheda "Crea" nel modale
        tabButtons.create.addEventListener('click', () => {
            // Se si va su "Crea" e non c'è un listener attivo, avviane uno nuovo
            if (!pairingListenerUnsubscribe) {
                handleCreateConnection();
            }
        });


        document.getElementById('join-button').addEventListener('click', async () => {
            if (!userId) return;

            const code = codeInput.value.trim();
            if (code.length !== 6) {
                showMessage("Il codice deve essere di 6 cifre.");
                return;
            }

            pairingCode = code;
            const pairDocRef = doc(db, 'artifacts', appId, 'public/data/pairings', pairingCode);

            try {
                const docSnap = await getDoc(pairDocRef);

                if (!docSnap.exists() || docSnap.data().status !== 'pending') {
                    showMessage("Codice non valido o già utilizzato.");
                    return;
                }

                // Aggiorna lo stato e imposta il joiner
                await updateDoc(pairDocRef, {
                    joinerId: userId,
                    status: 'connected'
                });

                partnerId = docSnap.data().initiatorId;
                closeAuthModal();
                showMessage("Connesso! Avvio della chat...");
                startMainApp();

            } catch (error) {
                console.error("Errore unione connessione:", error);
                showMessage("Impossibile unirsi. Controlla il codice.");
            }
        });

        function listenForPairing(docRef) {
            pairingListenerUnsubscribe = onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists() && docSnap.data().status === 'connected') {
                    partnerId = docSnap.data().joinerId;
                    
                    if (pairingListenerUnsubscribe) pairingListenerUnsubscribe();
                    
                    closeAuthModal();
                    showMessage("Partner connesso! Avvio della chat...");
                    startMainApp();
                }
            }, (error) => {
                console.error("Errore ascolto pairing:", error);
                showMessage("Errore di connessione. Riprova.");
                closeAuthModal();
            });
        }


        // --- Logica App Principale (Chat) ---

        function startMainApp() {
            showView('main');
            listenForMessages();
            // Mostra l'ID del partner per debugging/identificazione
            partnerStatus.textContent = `Partner ID: ${partnerId.substring(0, 6)}...`; 
            // Abilita il bottone di invio
            sendButton.disabled = false;
        }

        function listenForMessages() {
            if (messagesListenerUnsubscribe) messagesListenerUnsubscribe(); 

            // Collezione messaggi nel sottocollezione del pairing
            const messagesRef = collection(db, 'artifacts', appId, 'public/data/shared', pairingCode, 'messages');
            // Query (solo limitata per semplicità)
            const q = query(messagesRef);

            messagesListenerUnsubscribe = onSnapshot(q, (querySnapshot) => {
                const messages = [];
                querySnapshot.forEach((doc) => {
                    messages.push(doc.data());
                });

                // Ordina in memoria per timestamp
                messages.sort((a, b) => {
                    const timeA = a.timestamp ? a.timestamp.toMillis() : 0;
                    const timeB = b.timestamp ? b.timestamp.toMillis() : 0;
                    return timeA - timeB;
                });

                renderMessages(messages);

            }, (error) => {
                console.error("Errore ascolto messaggi:", error);
                showMessage("Errore di connessione alla chat.");
            });
        }

        function renderMessages(messages) {
            chatMessages.innerHTML = ''; 
            
            messages.forEach(msg => {
                const isSender = msg.senderId === userId;
                
                const messageWrapper = document.createElement('div');
                messageWrapper.classList.add('flex', 'w-full');
                
                const messageBubble = document.createElement('div');
                // Uso di rounded-2xl per un look più morbido anche se minimal
                messageBubble.classList.add('p-3', 'rounded-2xl', 'max-w-xs', 'lg:max-w-md', 'text-sm', 'break-words', 'shadow-sm');
                messageBubble.textContent = msg.text;

                if (isSender) {
                    messageWrapper.classList.add('justify-end');
                    // Colore accentuato per i messaggi inviati
                    messageBubble.classList.add('bg-indigo-600', 'text-white', 'bubble-sent');
                } else {
                    messageWrapper.classList.add('justify-start');
                    // Sfondo grigio chiaro per i messaggi ricevuti
                    messageBubble.classList.add('bg-gray-200', 'text-gray-900', 'bubble-received');
                }
                
                messageWrapper.appendChild(messageBubble);
                chatMessages.appendChild(messageWrapper);
            });

            // Scrolla automaticamente alla fine
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessage() {
            const text = chatInput.value.trim();
            if (text === '' || !userId || !pairingCode) return;

            // Disabilita il bottone per prevenire invii multipli rapidi
            sendButton.disabled = true;

            const messagesRef = collection(db, 'artifacts', appId, 'public/data/shared', pairingCode, 'messages');

            try {
                await addDoc(messagesRef, {
                    text: text,
                    senderId: userId,
                    timestamp: serverTimestamp()
                });
                chatInput.value = ''; // Pulisce l'input
                sendButton.disabled = false;
            } catch (error) {
                console.error("Errore invio messaggio:", error);
                showMessage("Impossibile inviare il messaggio.");
                sendButton.disabled = false;
            }
        }
        
        // Eventi per l'invio
        document.getElementById('send-button').addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); 
                sendMessage();
            }
        });

    </script>
</body>
</html>